# ä½“åŠ›æ˜¾ç¤ºä¼˜åŒ–å®Œæˆè¯´æ˜

## ğŸ¯ éœ€æ±‚åˆ†æ

### åŸéœ€æ±‚
- **è®¾ç½®é¡µé¢**: åªæ˜¾ç¤ºä½“åŠ›æ•°é‡ï¼Œä¸è¦å€’è®¡æ—¶
- **ä¸»é¡µåœ°å›¾**: æ˜¾ç¤º"3/5"æ ¼å¼ï¼Œéæ»¡ä½“åŠ›æ—¶æ˜¾ç¤ºå€’è®¡æ—¶
- **å€’è®¡æ—¶**: åŠ¨æ€æ›´æ–°ï¼Œå®æ—¶æ˜¾ç¤ºæœ€è¿‘ä¸€ä¸ªä½“åŠ›çš„æ¢å¤æ—¶é—´

## âœ… å®ç°æ–¹æ¡ˆ

### 1. **è®¾ç½®é¡µé¢ä½“åŠ›æ˜¾ç¤º**

**ä¿®æ”¹ä½ç½®**: `assets/script/game/ui/settingViewCmpt.ts`

**ä¿®æ”¹å‰**:
```typescript
updateHeartInfo() {
    const currentHeart = App.heartManager.getCurrentHeart();
    const maxHeart = App.heartManager.getMaxHeart();
    const countdown = App.heartManager.getNextRecoverCountdown();
    
    let heartText = `x${currentHeart}`;
    if (currentHeart < maxHeart && countdown > 0) {
        const timeStr = App.heartManager.formatCountdown(countdown);
        heartText += ` (${timeStr})`;
    }
    
    CocosHelper.updateLabelText(this.lbHeart, heartText);
}
```

**ä¿®æ”¹å**:
```typescript
/** æ›´æ–°ä½“åŠ›æ˜¾ç¤º - è®¾ç½®é¡µé¢åªæ˜¾ç¤ºæ•°é‡ */
updateHeartInfo() {
    if (this.lbHeart) {
        const currentHeart = App.heartManager.getCurrentHeart();
        CocosHelper.updateLabelText(this.lbHeart, `x${currentHeart}`);
    }
}
```

### 2. **ä¸»é¡µä½“åŠ›æ˜¾ç¤ºæ ¼å¼**

**ä¿®æ”¹ä½ç½®**: `assets/script/game/ui/homeViewCmpt.ts`

**æ–°çš„æ˜¾ç¤ºæ ¼å¼**:
```typescript
/** æ›´æ–°ä½“åŠ›æ˜¾ç¤º - ä¸»é¡µæ˜¾ç¤ºæ ¼å¼ä¸º "3/5" å¸¦å€’è®¡æ—¶ */
updateHeartInfo() {
    const currentHeart = App.heartManager.getCurrentHeart();
    const maxHeart = App.heartManager.getMaxHeart();
    let heartText = `${currentHeart}/${maxHeart}`;
    
    // å¦‚æœä¸æ˜¯æ»¡ä½“åŠ›ï¼Œæ˜¾ç¤ºä¸‹æ¬¡æ¢å¤å€’è®¡æ—¶
    if (currentHeart < maxHeart) {
        const countdown = App.heartManager.getNextRecoverCountdown();
        if (countdown > 0) {
            const timeStr = App.heartManager.formatCountdown(countdown);
            heartText += `\n${timeStr}`;  // æ¢è¡Œæ˜¾ç¤ºå€’è®¡æ—¶
        }
        
        // å¯åŠ¨å€’è®¡æ—¶æ›´æ–°å®šæ—¶å™¨
        this.startHeartUpdateTimer();
    } else {
        // æ»¡ä½“åŠ›æ—¶åœæ­¢å®šæ—¶å™¨
        this.stopHeartUpdateTimer();
    }
    
    CocosHelper.updateLabelText(this.lbLife, heartText);
}
```

### 3. **åŠ¨æ€å€’è®¡æ—¶æ›´æ–°æœºåˆ¶**

**å®šæ—¶å™¨ç®¡ç†**:
```typescript
private heartUpdateTimer: any = null; // ä½“åŠ›å€’è®¡æ—¶æ›´æ–°å®šæ—¶å™¨

/** å¯åŠ¨ä½“åŠ›å€’è®¡æ—¶æ›´æ–°å®šæ—¶å™¨ */
startHeartUpdateTimer() {
    // å¦‚æœå·²ç»æœ‰å®šæ—¶å™¨åœ¨è¿è¡Œï¼Œå…ˆæ¸…é™¤
    if (this.heartUpdateTimer) {
        return;
    }
    
    // æ¯ç§’æ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶
    this.heartUpdateTimer = setInterval(() => {
        const currentHeart = App.heartManager.getCurrentHeart();
        const maxHeart = App.heartManager.getMaxHeart();
        
        if (currentHeart >= maxHeart) {
            // æ»¡ä½“åŠ›æ—¶åœæ­¢å®šæ—¶å™¨
            this.stopHeartUpdateTimer();
            this.updateHeartInfo();
            return;
        }
        
        let heartText = `${currentHeart}/${maxHeart}`;
        const countdown = App.heartManager.getNextRecoverCountdown();
        if (countdown > 0) {
            const timeStr = App.heartManager.formatCountdown(countdown);
            heartText += `\n${timeStr}`;
        }
        
        CocosHelper.updateLabelText(this.lbLife, heartText);
    }, 1000);
}

/** åœæ­¢ä½“åŠ›å€’è®¡æ—¶æ›´æ–°å®šæ—¶å™¨ */
stopHeartUpdateTimer() {
    if (this.heartUpdateTimer) {
        clearInterval(this.heartUpdateTimer);
        this.heartUpdateTimer = null;
    }
}
```

### 4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**

**é¡µé¢åˆ‡æ¢æ—¶çš„å®šæ—¶å™¨ç®¡ç†**:
```typescript
evtPageView(pv: PageView) {
    let pageIndex = pv.getCurrentPageIndex();
    if (pageIndex == 2) { // ä¸»é¡µæ˜¯ç´¢å¼•2
        this.setHomeInfo();
    } else {
        // ç¦»å¼€ä¸»é¡µæ—¶åœæ­¢ä½“åŠ›å€’è®¡æ—¶å®šæ—¶å™¨
        this.stopHeartUpdateTimer();
    }
}

onDestroy() {
    // ... å…¶ä»–æ¸…ç†ä»£ç 
    
    // æ¸…ç†ä½“åŠ›æ›´æ–°å®šæ—¶å™¨
    if (this.heartUpdateTimer) {
        clearInterval(this.heartUpdateTimer);
        this.heartUpdateTimer = null;
    }
}
```

## ğŸ® ç”¨æˆ·ä½“éªŒæ•ˆæœ

### è®¾ç½®é¡µé¢
- **ç®€æ´æ˜¾ç¤º**: åªæ˜¾ç¤º `x3`ã€`x4`ã€`x5` è¿™ç§æ ¼å¼
- **ä¸“æ³¨åŠŸèƒ½**: ç”¨æˆ·ä¸“æ³¨äºè®¾ç½®æ“ä½œï¼Œä¸è¢«å€’è®¡æ—¶å¹²æ‰°

### ä¸»é¡µåœ°å›¾
- **å®Œæ•´ä¿¡æ¯**: æ˜¾ç¤º `3/5` è¿™ç§æ¸…æ™°çš„ä½“åŠ›çŠ¶æ€
- **åŠ¨æ€å€’è®¡æ—¶**: 
  - æ»¡ä½“åŠ›æ—¶ï¼šåªæ˜¾ç¤º `5/5`
  - éæ»¡ä½“åŠ›æ—¶ï¼šæ˜¾ç¤º `3/5` ä¸Šæ–¹æ˜¾ç¤º `04:32` å€’è®¡æ—¶
- **å®æ—¶æ›´æ–°**: å€’è®¡æ—¶æ¯ç§’æ›´æ–°ï¼Œç”¨æˆ·å¯ä»¥å®æ—¶çœ‹åˆ°å‰©ä½™æ—¶é—´

### æ˜¾ç¤ºç¤ºä¾‹

**æ»¡ä½“åŠ›çŠ¶æ€**:
```
5/5
```

**éæ»¡ä½“åŠ›çŠ¶æ€**:
```
3/5
04:32
```

**è®¾ç½®é¡µé¢**:
```
x3
```

## ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿

### 1. **æ€§èƒ½ä¼˜åŒ–**
- åªåœ¨ä¸»é¡µä¸”éæ»¡ä½“åŠ›æ—¶å¯åŠ¨å®šæ—¶å™¨
- ç¦»å¼€ä¸»é¡µæˆ–è¾¾åˆ°æ»¡ä½“åŠ›æ—¶è‡ªåŠ¨åœæ­¢å®šæ—¶å™¨
- é¿å…ä¸å¿…è¦çš„UIæ›´æ–°

### 2. **å†…å­˜å®‰å…¨**
- å®Œå–„çš„å®šæ—¶å™¨æ¸…ç†æœºåˆ¶
- ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
- é¿å…å†…å­˜æ³„æ¼

### 3. **ç”¨æˆ·ä½“éªŒ**
- ä¸åŒé¡µé¢æ˜¾ç¤ºä¸åŒè¯¦ç»†ç¨‹åº¦çš„ä¿¡æ¯
- ä¸»é¡µæä¾›æœ€å®Œæ•´çš„ä½“åŠ›ä¿¡æ¯å’Œå€’è®¡æ—¶
- è®¾ç½®é¡µé¢ä¿æŒç®€æ´ï¼Œä¸“æ³¨åŠŸèƒ½

### 4. **å“åº”å¼æ›´æ–°**
- ä½“åŠ›å˜åŒ–æ—¶ç«‹å³æ›´æ–°æ˜¾ç¤º
- å€’è®¡æ—¶ç²¾ç¡®åˆ°ç§’çº§
- æ»¡ä½“åŠ›æ—¶è‡ªåŠ¨åœæ­¢å€’è®¡æ—¶

## ğŸ¯ æœ€ç»ˆæ•ˆæœ

ç°åœ¨ä½“åŠ›æ˜¾ç¤ºç³»ç»Ÿå…·å¤‡ï¼š

- âœ… **è®¾ç½®é¡µé¢**: ç®€æ´çš„ `x3` æ ¼å¼
- âœ… **ä¸»é¡µåœ°å›¾**: å®Œæ•´çš„ `3/5` æ ¼å¼å¸¦åŠ¨æ€å€’è®¡æ—¶  
- âœ… **å®æ—¶æ›´æ–°**: å€’è®¡æ—¶æ¯ç§’åˆ·æ–°
- âœ… **æ™ºèƒ½ç®¡ç†**: è‡ªåŠ¨å¯åŠ¨/åœæ­¢å®šæ—¶å™¨
- âœ… **å†…å­˜å®‰å…¨**: å®Œå–„çš„èµ„æºæ¸…ç†æœºåˆ¶

ä½“åŠ›æ˜¾ç¤ºä¼˜åŒ–å®Œæˆï¼Œç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒé¡µé¢çœ‹åˆ°åˆé€‚è¯¦ç»†ç¨‹åº¦çš„ä½“åŠ›ä¿¡æ¯ï¼