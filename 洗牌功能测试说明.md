# 洗牌功能测试说明

## 功能概述
实现了当棋盘没有可移动元素时的自动洗牌功能，包括：
1. 检测棋盘是否有可移动的元素
2. 执行洗牌算法重新排列元素
3. 播放洗牌特效动画

## 关键文件
- `assets/script/game/ui/gameViewCmpt.ts` - 主要实现文件

## 新增方法

### 1. detectPossibleMoves()
- 检测棋盘是否存在可移动的元素组合
- 遍历所有相邻元素，模拟交换后检查是否能形成三消

### 2. shuffleBoard()  
- 使用Fisher-Yates洗牌算法重新排列棋盘元素
- 只洗牌普通元素，保持特效元素位置不变
- 包含详细的调试日志

### 3. playShuffleAnimation()
- 播放洗牌特效动画
- 随机延迟的旋转和缩放动画效果
- 播放洗牌音效

### 4. checkAndShuffle()
- 综合检查和洗牌控制方法
- 防止无限洗牌循环
- 包含完整的调试信息

## 触发条件
洗牌功能在以下情况触发：
1. 玩家进行无效操作后（交换不能形成消除的元素）
2. 消除完成后检查发现没有可移动元素

## 测试方法
1. 在Cocos Creator中打开项目
2. 运行游戏进入关卡
3. 尝试制造没有可移动元素的情况：
   - 连续进行消除直到棋盘剩余元素无法形成新的消除组合
   - 或者手动编辑关卡数据创建无解局面
4. 观察控制台输出的调试信息
5. 确认洗牌动画和音效正常播放
6. 验证洗牌后棋盘确实有了新的可移动组合

## 调试信息
控制台会输出以下关键信息：
- "开始检测可能的移动..."
- "检查了X个组合，未发现可移动元素" 或 "找到可移动组合：位置(x,y)与(x,y)"
- "检查可移动元素结果: true/false"
- "没有可移动的元素，开始洗牌"
- "收集到X个普通元素进行洗牌"
- "洗牌完成，重新分配了X个元素"
- "洗牌后可移动元素检查结果: true/false"

## 预期效果
- 当棋盘无法移动时，自动触发洗牌
- 洗牌过程播放旋转缩放动画
- 洗牌完成后棋盘具有新的可移动组合
- 整个过程流畅自然，用户体验良好